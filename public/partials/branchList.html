<div class="loader" ng-show="loading">
</div>
<div ng-show="!loading">
    <table class="table sortable table-condensed">
        <thead>
        <tr class="header">
            <th ng-click="orderingPredicate='name'; reverse=!reverse"
                ng-class="{sort:orderingPredicate == 'name', reverse:reverse}">
                Branch
                <span ng-class="{arrow:orderingPredicate == 'name', up:reverse}"></span>
            </th>
            <th>Users</th>
            <th>State</th>
            <th ng-click="orderingPredicate='pullRequest.id'; reverse=!reverse">
                PR
                <span ng-class="{arrow:orderingPredicate == 'pullRequest.id', up:reverse}"></span>
            </th>
            <th>Build</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="branch in allBranches | orderBy:orderingPredicate:reverse" ng-controller="branchLineController"
            ng-class="getLastBuildStatus()">
            <td class="branch-name">
                <entity-title entity="branch.entity" url="#/branches/{{branch.name | encode }}"></entity-title>
                <span ng-show="!branch.entity"><a href="#/branches/{{branch.name | encode }}">{{branch.name}}</a></span>

            </td>
            <td>
                <div ng-show="branch.entity">
                            <span ng-repeat="assignment in branch.entity.assignments"
                                  class="ui-role ui-role-active-{{assignment.isResponsible}}">
                                <img ng-src="{{assignment.avatar}}30"
                                     title="{{assignment.role}}: {{assignment.firstName}} {{assignment.lastName}}">
                            </span>
                </div>
            </td>
            <td>
                <div ng-show="branch.entity">
                    <div class="btn-group btn-group-stretch">
                        <button type="button" class="btn dropdown-toggle"
                                data-toggle="dropdown">
                            {{branch.entity.state.name}}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li ng-repeat="entityState in branch.entity.state.nextStates"><a href="#">{{entityState.name}}</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </td>
            <td>
                <div ng-show="branch.pullRequest" class="btn-group btn-group-stretch">
                    <a target="_blank" href="{{branch.pullRequest.url}}"
                       class="btn btn-default btn-{{getPullRequestClass() | status }}">
                        #{{branch.pullRequest.id}}</a>
                </div>
            </td>
            <td>
                <div class="btn-group btn-group-stretch">
                    <button type="button" class="btn dropdown-toggle btn-{{getLastBuildStatus() | status}}"
                            data-toggle="dropdown">
                        <span ng-show="branch.lastBuild">{{ branch.lastBuild.timeStamp | date }}</span>
                        <span ng-show="!branch.lastBuild">Never built</span>
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a ng-show="branch.lastBuild" class="btn btn-link" target="_blank" href="{{branch.lastBuild.url}}">
                                Open in Jenkins
                                <span class="glyphicon glyphicon-export"></span>
                            </a>
                            <button type="button" class="btn btn-default" ng-repeat="action in branch.buildActions" ng-click="forceBuild(action)">
                                {{action.name}}
                            </button>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
